var Actor,Circle,CircleActor,Controller,Game,Keys,Loader,MathHelpers,Rect,STATE,Shape,Sprite,SquareActor,Stage,TileMap,Timer,Vector,bind=function(t,i){return function(){return t.apply(i,arguments)}},extend=function(t,i){function e(){this.constructor=t}for(var n in i)hasProp.call(i,n)&&(t[n]=i[n]);return e.prototype=i.prototype,t.prototype=new e,t.__super__=i.prototype,t},hasProp={}.hasOwnProperty;Loader={numberOfImages:0,numberComplete:0,images:{},loadImage:function(t,i){var e;return Loader.numberOfImages++,e=new Image,e.onload=function(){return Loader.images[t]=e,Loader.numberComplete++},e.src=i},getImage:function(t){return Loader.images[t]},getProgress:function(){return Loader.numberComplete/Loader.numberOfImages},doneLoading:function(){return 1===this.getProgress()}},Vector=function(){function t(t,i){this.x=null!=t?t:0,this.y=null!=i?i:0,this.subtract=bind(this.subtract,this),this.add=bind(this.add,this),this.rotate=bind(this.rotate,this)}return t.prototype.rotate=function(t){var i,e;return i=this.x,e=this.y,this.x=i*Math.cos(t)-e*Math.sin(t),this.y=i*Math.sin(t)+e*Math.cos(t)},t.prototype.add=function(i){if(i instanceof t)return this.x+=i.x,this.y+=i.y},t.prototype.subtract=function(i){if(i instanceof t)return this.x-=i.x,this.y-=i.y},t}(),Shape=function(){function t(t){this.position=t}return t}(),Circle=function(t){function i(t,e){this.radius=null!=e?e:0,i.__super__.constructor.call(this,t)}return extend(i,t),i}(Shape),Rect=function(t){function i(t,e,n){this.w=null!=e?e:0,this.h=null!=n?n:0,i.__super__.constructor.call(this,t)}return extend(i,t),i}(Shape),MathHelpers={isCircleInRect:function(t,i){var e,n,s,o,r,h,a,u;if(t instanceof Circle&&i instanceof Rect)return a=i.position.x,r=a+i.w,u=i.position.y,h=u+i.h,s=t.position.x-t.radius,e=t.position.x+t.radius,o=t.position.y-t.radius,n=t.position.y+t.radius,!(a>s||r<e||u>o||h<n)},doesCircleRectIntersect:function(t,i){var e,n,s,o;if(t instanceof Circle&&i instanceof Rect)return e=t.position,o=i.position,n=e.x-Math.max(o.x,Math.min(e.x,o.x+i.w)),s=e.y-Math.max(o.y,Math.min(e.y,o.y+i.h)),n*n+s*s<t.radius*t.radius},doesCircleCircleIntersect:function(t,i){var e,n,s;if(t instanceof Circle&&i instanceof Circle)return e=t.position,n=i.position,s=MathHelpers.getDistance(e.x,e.y,n.x,n.y),!(t.radius+i.radius<s)},toDegrees:function(t){return t*(180/Math.PI)},toRadians:function(t){return t*(Math.PI/180)},getDistance:function(t,i,e,n){return Math.sqrt(Math.pow(e-t,2)+Math.pow(n-i,2))}},Sprite=function(){function t(t,i){this.image=t,this.spriteSize=i,this.updateFrame=bind(this.updateFrame,this),this.setCycle=bind(this.setCycle,this),this.frame=0,this.timer=void 0}return t.prototype.draw=function(t,i,e){var n,s,o;return n=this.cycle[this.frame],s=n.col*this.spriteSize,o=n.row*this.spriteSize,t=Math.round(t),i=Math.round(i),e.save(),e.translate(t-this.spriteSize/2,i-this.spriteSize/2),e.drawImage(this.image,s,o,this.spriteSize,this.spriteSize,0,0,this.spriteSize,this.spriteSize),e.restore()},t.prototype.setCycle=function(t,i){return this.cycle=t,this.interval=null!=i?i:0,this.cycleLength=this.cycle.length,this.frame=0,this.timer=new Timer(this.interval)},t.prototype.updateFrame=function(t){if(this.timer.tick(t),this.timer.hasEnded())return this.frame=(this.frame+1)%this.cycleLength,this.timer.restart()},t}(),Controller=function(){function t(){document.onkeyup=function(i){return t.pressed[i.keyCode]=!1},document.onkeydown=function(i){return t.pressed[i.keyCode]=!0}}var i;return i=null,t.pressed=new Map,t.get=function(){return null==this.instance&&(i=new this),i},t.prototype.isPressed=function(i){return t.pressed[i]},t}(),Keys={ENTER:13,LEFT:37,RIGHT:39,UP:38,DOWN:40,A:65,D:68,W:87,S:83},Actor=function(){function t(t,i,e){this.direction=null!=e?e:0,this.lookAt=bind(this.lookAt,this),this.setDirection=bind(this.setDirection,this),this.setPosition=bind(this.setPosition,this),this.setStage=bind(this.setStage,this),this.setRender=bind(this.setRender,this),this.setUpdate=bind(this.setUpdate,this),this.setInit=bind(this.setInit,this),this.position=new Vector(t,i),this.stage=null,this.destroy=!1}return t.prototype.init=function(){if(this._init)return this._init()},t.prototype.update=function(t){if(this._update)return this._update(t)},t.prototype.render=function(){if(this._render)return this._render()},t.prototype.setInit=function(t){return null==t&&(t=void 0),this._init=t},t.prototype.setUpdate=function(t){return null==t&&(t=void 0),this._update=t},t.prototype.setRender=function(t){return null==t&&(t=void 0),this._render=t},t.prototype.setStage=function(t){this.stage=t},t.prototype.setPosition=function(t,i){return null==t&&(t=0),null==i&&(i=0),this.position=new Vector(t,i)},t.prototype.setDirection=function(t){return this.direction=t*(Math.PI/180)},t.prototype.shouldDestroy=function(){return this.destroy},t.prototype.lookAt=function(t){return t instanceof Vector?this.direction=Math.atan2(t.x-this.position.y,t.x-this.position.x):void console.log("ERROR: "+t+" is not an Point")},t}(),SquareActor=function(t){function i(t,e,n,s,o){null==n&&(n=0),this.width=null!=s?s:0,this.height=null!=o?o:0,this.updateBody=bind(this.updateBody,this),i.__super__.constructor.call(this,t,e,n),this.body=new Rect(this.position,this.width,this.height)}return extend(i,t),i.prototype.updateBody=function(){return this.body=new Rect(this.position,this.width,this.height)},i.prototype.drawDebug=function(){var t;return null==this.stage&&null==this.stage.getContext()?void console.log("Stage context cannot is null, or there is no context set"):(t=this.stage.getContext(),t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.direction),t.translate(-this.width/2,-this.height/2),t.fillStyle="#FF0000",t.fillRect(0,0,this.width,this.height),t.translate(this.width/2,this.height/2),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width/2,0),t.lineWidth=1,t.strokeStyle="#000000",t.stroke(),t.closePath(),t.restore())},i}(Actor),CircleActor=function(t){function i(t,e,n,s){null==n&&(n=0),this.radius=null!=s?s:0,this.updateBody=bind(this.updateBody,this),i.__super__.constructor.call(this,t,e,n),this.body=new Circle(this.position,this.radius)}return extend(i,t),i.prototype.updateBody=function(){return this.body=new Circle(this.position,this.radius)},i.prototype.drawDebug=function(t){var i;return null==t&&(t="#FF0000"),null==this.stage&&null==this.stage.getContext()?void console.log("Stage context cannot is null, or there is no context set"):(i=this.stage.getContext(),i.save(),i.translate(this.body.position.x,this.body.position.y),i.rotate(this.direction),i.beginPath(),i.arc(0,0,this.body.radius,0,2*Math.PI),i.fillStyle=t,i.fill(),i.closePath(),i.beginPath(),i.moveTo(0,0),i.lineTo(this.body.radius,0),i.lineWidth=1,i.strokeStyle="#000000",i.stroke(),i.closePath(),i.restore())},i}(Actor),TileMap=function(){function t(t,i,e,n,s){this.cols=null!=t?t:0,this.rows=null!=i?i:0,this.tileSize=null!=e?e:0,this.tiles=null!=n?n:[],this.ctx=null!=s?s:void 0}return t.prototype.getTile=function(t,i){return this.tiles[i*this.cols+t]},t.prototype.render=function(){if(this._render)return this._render()},t}(),Timer=function(){function t(t){this.timeout=t,this.restart=bind(this.restart,this),this.end=bind(this.end,this),this.tick=bind(this.tick,this),this.elapsed=0}return t.prototype.tick=function(t){return this.elapsed+=t},t.prototype.end=function(t){return this.elapsed=this.timeout},t.prototype.hasEnded=function(){return this.elapsed>=this.timeout},t.prototype.restart=function(){return this.elapsed=0},t}(),STATE={finished:0,running:1},Stage=function(){function t(t,i,e){this.width=t,this.height=i,this.ctx=null!=e?e:void 0,this.setContext=bind(this.setContext,this),this.addActor=bind(this.addActor,this),this.actors=[],this.bounds=new Rect(new Vector,this.width,this.height),this.state=STATE.running}return t.prototype.addActor=function(t){return t instanceof Actor?(t.setStage(this),t.init(),this.actors.push(t)):void console.log("ERROR: "+t+" is not an Actor")},t.prototype.init=function(){if(this.actors=[],this.state=STATE.running,this._init)return this._init()},t.prototype.update=function(t){var i,e,n,s,o;for(this._update&&this._update(t),s=this.actors,o=[],e=0,n=s.length;e<n;e++)i=s[e],o.push(i.update(t));return o},t.prototype.render=function(){var t,i,e,n,s;for(this._render&&this._render(),n=this.actors,s=[],i=0,e=n.length;i<e;i++)t=n[i],s.push(t.render());return s},t.prototype.setContext=function(t){this.ctx=t},t.prototype.getContext=function(){return this.ctx},t.prototype.isCircleInBounds=function(t){return t instanceof Circle||retrun(!1),MathHelpers.isCircleInRect(t,this.bounds)},t}(),Game=function(){function t(i,e,n,s){this.canvas=null!=s?s:void 0,this.gameStep=bind(this.gameStep,this),this.render=bind(this.render,this),this.start=bind(this.start,this),this.border=bind(this.border,this),this.backgroundColor=bind(this.backgroundColor,this),this.setStage=bind(this.setStage,this),this.canvas||(this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas)),this.canvas.ctx=this.canvas.getContext("2d"),this.canvas.width=i,this.canvas.height=e,this.canvas.addEventListener("mousemove",function(i){var e;return e=this.getBoundingClientRect(),t.mousePoint=new Vector(i.clientX-e.left,i.clientY-e.top)}),this.running=!1,this.setup=n||void 0,this.stage=null,this.startTime=0,this.accumulator=0,this.actualFps=0,this.setup&&this.setup()}return t.fps=60,t.frameDuration=1e3/t.fps,t.mousePoint=void 0,t.prototype.setStage=function(t,i){return null==i&&(i=void 0),t instanceof Stage?(this.stage=t,this.stage.setContext(this.canvas.ctx),this.stage.init()):void console.log("ERROR: "+t+" is not an Stage")},t.prototype.setStageTransition=function(t){return this._transition=t},t.prototype.backgroundColor=function(t){return this.canvas.style.backgroundColor=t},t.prototype.border=function(t){return this.canvas.style.border=t},t.prototype.getMouseLocation=function(){return t.mousePoint},t.prototype.start=function(){return this.running=!0,this.startTime=Date.now(),this.gameStep(),window.onEachFrame(this.render)},t.prototype.update=function(t){if(Loader.doneLoading())return null!=this._transition&&this._transition(),null!=this.stage?this.stage.update(t):void 0},t.prototype.render=function(){if(Loader.doneLoading()&&null!=this.running)return this.canvas.ctx.save(),this.canvas.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.ctx.restore(),null!=this.stage?this.stage.render():void 0},t.prototype.gameStep=function(){var i,e;if(null!=this.running){for(i=Date.now(),e=i-this.startTime,e>1e3&&(e=t.frameDuration),this.actualFps=1e3/e,this.startTime=i,this.accumulator+=e;this.accumulator>=t.frameDuration;)this.update(t.frameDuration),this.accumulator-=t.frameDuration;return setTimeout(this.gameStep,t.frameDuration)}},t}(),function(){var t;t=void 0,t=window.requestAnimationFrame?function(t){var i;(i=function(){t(),requestAnimationFrame(i)})()}:window.webkitRequestAnimationFrame?function(t){var i;(i=function(){t(),webkitRequestAnimationFrame(i)})()}:window.mozRequestAnimationFrame?function(t){var i;(i=function(){t(),mozRequestAnimationFrame(i)})()}:function(t){setInterval(t,Game.frameDuration)},window.onEachFrame=t}();