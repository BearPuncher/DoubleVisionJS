var Actor,Box,Circle,CircleActor,Controller,Game,Keys,Loader,MathHelpers,Polygon,STATE,SquareActor,Stage,TileMap,Timer,Vector,bind=function(t,e){return function(){return t.apply(e,arguments)}},extend=function(t,e){function i(){this.constructor=t}for(var s in e)hasProp.call(e,s)&&(t[s]=e[s]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;Loader={numberOfImages:0,numberComplete:0,images:{},loadImage:function(t,e){var i;return Loader.numberOfImages++,i=new Image,i.onload=function(){return Loader.images[t]=i,Loader.numberComplete++},i.src=e},getImage:function(t){return Loader.images[t]},getProgress:function(){return Loader.numberComplete/Loader.numberOfImages},doneLoading:function(){return 1===this.getProgress()}},Vector=SAT.Vector,Circle=SAT.Circle,Polygon=SAT.Polygon,Box=SAT.Box,MathHelpers={toDegrees:function(t){return t*(180/Math.PI)},toRadians:function(t){return t*(Math.PI/180)}},Controller=function(){function t(){document.onkeyup=function(e){return t.pressed[e.keyCode]=!1},document.onkeydown=function(e){return t.pressed[e.keyCode]=!0}}var e;return e=null,t.pressed=new Map,t.get=function(){return null==this.instance&&(e=new this),e},t.prototype.isPressed=function(e){return t.pressed[e]},t}(),Keys={ENTER:13,LEFT:37,RIGHT:39,UP:38,DOWN:40,A:65,D:68,W:87,S:83},Actor=function(){function t(t,e,i){this.direction=null!=i?i:0,this.lookAt=bind(this.lookAt,this),this.setDirection=bind(this.setDirection,this),this.setPosition=bind(this.setPosition,this),this.setStage=bind(this.setStage,this),this.setRender=bind(this.setRender,this),this.setUpdate=bind(this.setUpdate,this),this.setInit=bind(this.setInit,this),this.position=new Vector(t,e),this.stage=null,this.body=null,this.destroy=!1}return t.prototype.init=function(){if(this._init)return this._init()},t.prototype.update=function(t){if(this._update)return this._update(t)},t.prototype.render=function(){if(this._render)return this._render()},t.prototype.setInit=function(t){return null==t&&(t=void 0),this._init=t},t.prototype.setUpdate=function(t){return null==t&&(t=void 0),this._update=t},t.prototype.setRender=function(t){return null==t&&(t=void 0),this._render=t},t.prototype.setStage=function(t){this.stage=t},t.prototype.setPosition=function(t,e){return null==t&&(t=0),null==e&&(e=0),this.position=new Vector(t,e)},t.prototype.setDirection=function(t){return this.direction=t*(Math.PI/180)},t.prototype.shouldDestroy=function(){return this.destroy},t.prototype.lookAt=function(t){return t instanceof Vector?this.direction=Math.atan2(t.x-this.position.y,t.x-this.position.x):void console.log("ERROR: "+t+" is not an Point")},t}(),SquareActor=function(t){function e(t,i,s,n,o){null==s&&(s=0),this.width=null!=n?n:0,this.height=null!=o?o:0,this.updateBody=bind(this.updateBody,this),e.__super__.constructor.call(this,t,i,s),this.body=new Box(this.position,this.width,this.height).toPolygon(),this.body.rotate(s)}return extend(e,t),e.prototype.updateBody=function(){return this.body=new Box(this.position,this.width,this.height).toPolygon(),this.body.rotate(direction)},e.prototype.drawDebug=function(){var t;return null==this.stage&&null==this.stage.getContext()?void console.log("Stage context cannot is null, or there is no context set"):(t=this.stage.getContext(),t.save(),t.translate(this.position.x,this.position.y),t.rotate(this.direction),t.translate(-this.width/2,-this.height/2),t.fillStyle="#FF0000",t.fillRect(0,0,this.width,this.height),t.translate(this.width/2,this.height/2),t.beginPath(),t.moveTo(0,0),t.lineTo(this.width/2,0),t.lineWidth=1,t.strokeStyle="#000000",t.stroke(),t.closePath(),t.restore())},e}(Actor),CircleActor=function(t){function e(t,i,s,n){null==s&&(s=0),this.radius=null!=n?n:0,this.updateBody=bind(this.updateBody,this),e.__super__.constructor.call(this,t,i,s),this.body=new Circle(this.position,this.radius)}return extend(e,t),e.prototype.updateBody=function(){return this.body.pos=this.position,this.body.r=this.radius},e.prototype.drawDebug=function(t){var e;return null==t&&(t="#FF0000"),null==this.stage&&null==this.stage.getContext()?void console.log("Stage context cannot is null, or there is no context set"):(e=this.stage.getContext(),e.save(),e.translate(this.body.pos.x,this.body.pos.y),e.rotate(this.direction),e.beginPath(),e.arc(0,0,this.body.r,0,2*Math.PI),e.fillStyle=t,e.fill(),e.closePath(),e.beginPath(),e.moveTo(0,0),e.lineTo(this.body.r,0),e.lineWidth=1,e.strokeStyle="#000000",e.stroke(),e.closePath(),e.restore())},e}(Actor),TileMap=function(){function t(t,e,i,s,n){this.cols=null!=t?t:0,this.rows=null!=e?e:0,this.tileSize=null!=i?i:0,this.tiles=null!=s?s:[],this.ctx=null!=n?n:void 0}return t.prototype.getTile=function(t,e){return this.tiles[e*this.cols+t]},t.prototype.render=function(){if(this._render)return this._render()},t}(),Timer=function(){function t(t){this.timeout=t,this.restart=bind(this.restart,this),this.end=bind(this.end,this),this.tick=bind(this.tick,this),this.elapsed=0}return t.prototype.tick=function(t){return this.elapsed+=t},t.prototype.end=function(t){return this.elapsed=this.timeout},t.prototype.hasEnded=function(){return this.elapsed>=this.timeout},t.prototype.restart=function(){return this.elapsed=0},t}(),STATE={finished:0,running:1},Stage=function(){function t(t,e,i){this.width=t,this.height=e,this.ctx=null!=i?i:void 0,this.setContext=bind(this.setContext,this),this.addActor=bind(this.addActor,this),this.actors=[],this.bounds=new Box(new Vector,this.width,this.height).toPolygon(),this.state=STATE.running}return t.prototype.addActor=function(t){return t instanceof Actor?(t.setStage(this),t.init(),this.actors.push(t)):void console.log("ERROR: "+t+" is not an Actor")},t.prototype.init=function(){if(this.actors=[],this.state=STATE.running,this._init)return this._init()},t.prototype.update=function(t){var e,i,s,n,o;for(this._update&&this._update(t),n=this.actors,o=[],i=0,s=n.length;i<s;i++)e=n[i],o.push(e.update(t));return o},t.prototype.render=function(){var t,e,i,s,n;for(this._render&&this._render(),s=this.actors,n=[],e=0,i=s.length;e<i;e++)t=s[e],n.push(t.render());return n},t.prototype.setContext=function(t){this.ctx=t},t.prototype.getContext=function(){return this.ctx},t.prototype.isCircleInBounds=function(t){var e,i;return t instanceof Circle||retrun(!1),i=new SAT.Response,e=SAT.testCirclePolygon(t,this.bounds,i),!(!e||!i.aInB)},t}(),Game=function(){function t(e,i,s,n){this.canvas=null!=n?n:void 0,this.gameStep=bind(this.gameStep,this),this.render=bind(this.render,this),this.start=bind(this.start,this),this.border=bind(this.border,this),this.backgroundColor=bind(this.backgroundColor,this),this.setStage=bind(this.setStage,this),this.canvas||(this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas)),this.canvas.ctx=this.canvas.getContext("2d"),this.canvas.width=e,this.canvas.height=i,this.canvas.addEventListener("mousemove",function(e){var i;return i=this.getBoundingClientRect(),t.mousePoint=new Vector(e.clientX-i.left,e.clientY-i.top)}),this.running=!1,this.setup=s||void 0,this.stage=null,this.startTime=0,this.accumulator=0,this.actualFps=0,this.setup&&this.setup()}return t.fps=60,t.frameDuration=1e3/t.fps,t.mousePoint=void 0,t.prototype.setStage=function(t,e){return null==e&&(e=void 0),t instanceof Stage?(this.stage=t,this.stage.setContext(this.canvas.ctx),this.stage.init()):void console.log("ERROR: "+t+" is not an Stage")},t.prototype.setStageTransition=function(t){return this._transition=t},t.prototype.backgroundColor=function(t){return this.canvas.style.backgroundColor=t},t.prototype.border=function(t){return this.canvas.style.border=t},t.prototype.getMouseLocation=function(){return t.mousePoint},t.prototype.start=function(){return this.running=!0,this.startTime=Date.now(),this.gameStep(),window.onEachFrame(this.render)},t.prototype.update=function(t){if(Loader.doneLoading())return null!=this._transition&&this._transition(),null!=this.stage?this.stage.update(t):void 0},t.prototype.render=function(){if(Loader.doneLoading()&&null!=this.running)return this.canvas.ctx.save(),this.canvas.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.ctx.restore(),null!=this.stage?this.stage.render():void 0},t.prototype.gameStep=function(){var e,i;if(null!=this.running){for(e=Date.now(),i=e-this.startTime,i>1e3&&(i=t.frameDuration),this.actualFps=1e3/i,this.startTime=e,this.accumulator+=i;this.accumulator>=t.frameDuration;)this.update(t.frameDuration),this.accumulator-=t.frameDuration;return setTimeout(this.gameStep,t.frameDuration)}},t}(),function(){var t;t=void 0,t=window.requestAnimationFrame?function(t){var e;(e=function(){t(),requestAnimationFrame(e)})()}:window.webkitRequestAnimationFrame?function(t){var e;(e=function(){t(),webkitRequestAnimationFrame(e)})()}:window.mozRequestAnimationFrame?function(t){var e;(e=function(){t(),mozRequestAnimationFrame(e)})()}:function(t){setInterval(t,Game.frameDuration)},window.onEachFrame=t}();